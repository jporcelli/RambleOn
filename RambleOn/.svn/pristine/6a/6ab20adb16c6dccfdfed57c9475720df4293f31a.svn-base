package rambleonevents;

import accountdata.Account;
import accountdata.AccountDataManager;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;
import rambleon.RambleOnScreenManager;
import static rambleon.RambleOnSettings.*;

/**
 * This is a handler for the selection of an account from the table on the
 * accounts page which holds the list of active user accounts.
 *
 * @author James C. Porcelli, SBU ID 108900819
 */
public class AccountSelectionHandler implements ListSelectionListener {

    //THE SCREEN MANAGER FOR THIS APP
    private RambleOnScreenManager screenManager;

    /**
     * Creates a new handler for the table of accounts on the accounts page.
     *
     * @param screenManager
     */
    public AccountSelectionHandler(RambleOnScreenManager screenManager) {
        this.screenManager = screenManager;
    }

    /**
     * Handles events generated by selection of a table cell from the table of
     * active accounts on the account page.
     *
     * @param e The event generated by the table of accounts on the accounts
     * page.
     */
    @Override
    public void valueChanged(ListSelectionEvent e) {
        //SET THE CURRENT ACCOUNT TO THE SELECTED ACCOUNT
        int userAtRow = e.getFirstIndex();
        //GET THE ACCOUNTS MANAGER WHICH HAS ALL OUR ACCOUNTS INFORMATION
        AccountDataManager accountsManager = screenManager.getAccountsManager();
        //THEN GET THE USER NAME OF THE ACCOUNT AT THE INDEX IN THE LIST USED TO BUILD THE TABLE
        String selectedAccountUserName = accountsManager.getUserNames().get(userAtRow);
        //MAP THE USER NAME TO THE ACTUAL ACCOUNT OBJECT FOR THAT USER
        Account selectedAccount = accountsManager.getAccounts().get(selectedAccountUserName);
        //AND SET THE CURRENT ACCOUNT WITH THE SELECTED PLAYERS ACCOUNT
        accountsManager.setCurrentAccount(selectedAccount);

        //ONLY INITIALIZE THE SCREEN IF ITS THE FIRST TIME AT THIS SCREEN
        if (screenManager.getCurrentAccountScreen() == null) {
            screenManager.initCurrentAccountScreen();
        }

        //WE NEED TO CLEAR ALL THE REGIONS FROM WORLD EACH TIME WE GO TO THE
        //CURRENT ACCOUNT SCREEN FOR A NEW ACCOUNT BECAUSE IF IT IS NOT THE
        //FIRST TIME WE GO TO THE SCREEN DURING THE RUN OF THE APPLICATION 
        //THEN EVERYTHING IS ALREADY INITIALIZED AND THUS WE ONLY NEED TO RESET
        //SOME DATA NOT INITIALIZE IT 
        screenManager.getWorldManager().reset(REGIONS_PLAYED_ROOT);

        //NOW CHANGE THE CURRENT PAGE TO THE CURRENT ACCOUNTSN PAGE
        screenManager.getWindow().remove(screenManager.getAccountsScreen());
        screenManager.getWindow().add(screenManager.getCurrentAccountScreen());
        screenManager.refreshWindow();



    }
}
